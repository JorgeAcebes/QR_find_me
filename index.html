<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de QR Personal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #ffffff;
            color: #000000;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #000;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #666;
        }

        .main-button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            padding: 15px 30px;
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 0;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
        }

        .main-button:hover {
            background-color: #333;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 2% auto;
            padding: 30px;
            border: 2px solid #000;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close:hover {
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #000;
            background-color: #fff;
            font-size: 1rem;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #333;
        }

        .form-group textarea {
            height: 80px;
        }

        .form-section {
            border-top: 1px solid #ccc;
            padding-top: 20px;
            margin-top: 30px;
        }

        .form-section h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .result-section {
            display: none;
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            border: 2px solid #000;
            background-color: #f9f9f9;
        }

        .result-section h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        #qrCanvas {
            margin: 20px 0;
            border: 1px solid #ccc;
            max-width: 100%;
            height: auto;
        }

        .download-button {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s ease;
        }

        .download-button:hover {
            background-color: #333;
        }

        .url-info {
            background-color: #e8f4fd;
            border: 1px solid #b3d4fc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }

        .url-info h4 {
            margin-bottom: 10px;
            color: #1a73e8;
        }

        .generated-url {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            word-break: break-all;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .preview-section {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #fafafa;
            display: none;
        }

        .preview-section h4 {
            margin-bottom: 15px;
        }

        .preview-content {
            text-align: left;
            font-family: monospace;
            font-size: 0.9rem;
            background-color: white;
            padding: 15px;
            border: 1px solid #ccc;
            white-space: pre-wrap;
        }

        .logo-preview {
            max-width: 50px;
            max-height: 50px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Estilos para la página de información */
        #contactPage {
            display: none;
        }

        .contact-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 30px auto;
            max-width: 600px;
        }

        .contact-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .contact-header h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .contact-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .contact-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
            border: 3px solid #000;
        }

        .contact-info {
            margin-bottom: 25px;
        }

        .contact-info h3 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: #444;
        }

        .contact-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        .contact-item i {
            width: 30px;
            text-align: center;
            color: #1a73e8;
            font-size: 1.2rem;
        }

        .contact-message {
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-style: italic;
            border-left: 4px solid #1a73e8;
        }

        .contact-message p {
            margin-bottom: 10px;
        }

        .contact-logo {
            max-width: 80px;
            max-height: 80px;
            display: block;
            margin: 20px auto;
        }

        .back-button {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 12px 20px;
            background-color: #000;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }

        .back-button:hover {
            background-color: #333;
        }

        /* Modal para seleccionar dispositivo */
        .device-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .device-modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 30px;
            border: 2px solid #000;
            width: 90%;
            max-width: 400px;
        }

        .device-option {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #000;
            color: white;
            text-align: center;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .device-option:hover {
            background-color: #333;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .modal-content {
                margin: 1% auto;
                padding: 20px;
                width: 95%;
                max-height: 95vh;
            }
            
            .contact-card {
                padding: 20px;
            }
            
            .contact-image {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="generatorPage">
        <div class="header">
            <h1>Generador de QR Personalizado</h1>
            <p>Crea códigos QR con logo incrustado que contienen información personalizada</p>
        </div>

        <button class="main-button" onclick="openModal()">
            Editar información
        </button>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Generando código QR...</p>
        </div>
        
        <div class="result-section" id="resultSection">
            <h3>Tu código QR está listo</h3>
            
            <canvas id="qrCanvas"></canvas>
            <div>
                <button class="download-button" onclick="downloadQR()">
                    Descargar QR (PNG)
                </button>
                <button class="download-button" onclick="testQR()" style="background-color: #1a73e8;">
                    Probar Contenido
                </button>
                <button class="download-button" onclick="openDeviceModal()" style="background-color: #4CAF50;">
                    Generar fondo de pantalla
                </button>
            </div>

            <div class="url-info" id="urlInfo">
                <h4>URL generada:</h4>
                <div class="generated-url" id="generatedUrl"></div>
            </div>
            
            <div class="preview-section" id="previewSection">
                <h4>Contenido del QR:</h4>
                <div class="preview-content" id="previewContent"></div>
            </div>
        </div>
    </div>

    <!-- Modal para editar información -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <button class="close" onclick="closeModal()">&times;</button>
            
            <form id="qrForm">
                <div class="form-group">
                    <label for="title">Título</label>
                    <input type="text" id="title" placeholder="Mi Contenido Personalizado">
                </div>

                <div class="form-group">
                    <label for="fullName">Nombre y apellidos</label>
                    <input type="text" id="fullName" placeholder="Mi nombre">
                </div>
                
                <div class="form-group">
                    <label for="email">Correo electrónico</label>
                    <input type="email" id="email" placeholder="ejemplo@correo.com">
                </div>

                <div class="form-group">
                    <label for="phone">Número de teléfono</label>
                    <input type="tel" id="phone" placeholder="+34 600 000 000">
                </div>
                
                <div class="form-group">
                    <label for="phrase1">Mensaje en español</label>
                    <textarea id="phrase1" placeholder="Por favor, contacta conmigo"></textarea>
                </div>

                <div class="form-group">
                    <label for="phrase2">Mensaje en inglés</label>
                    <textarea id="phrase2" placeholder="Please, contact me"></textarea>
                </div>
               
                <div class="form-group">
                    <label for="logo">Logo para incrustar en el QR</label>
                    <input type="file" id="logo" accept="image/*">
                    <small>Esta imagen se incrustará en el centro del código QR</small>
                    <div id="logoPreview"></div>
                </div>

                <div class="form-group">
                    <label for="qrSize">Tamaño del QR</label>
                    <select id="qrSize">
                        <option value="250">250x250px</option>
                        <option value="300" selected>300x300px</option>
                        <option value="400">400x400px</option>
                        <option value="500">500x500px</option>
                    </select>
                </div>

                <button type="button" class="main-button" onclick="generateQR()">
                    Generar QR
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para seleccionar dispositivo -->
    <div id="deviceModal" class="device-modal">
        <div class="device-modal-content">
            <button class="close" onclick="closeDeviceModal()">&times;</button>
            <h3>Selecciona el dispositivo</h3>
            <p>Elige el tipo de dispositivo para generar el fondo de pantalla con las dimensiones adecuadas:</p>
            
            <button class="device-option" onclick="generateWallpaper('mobile')">
                Móvil
            </button>
            
            <button class="device-option" onclick="generateWallpaper('tablet')">
                Tablet
            </button>
            
            <button class="device-option" onclick="generateWallpaper('desktop')">
                Ordenador
            </button>
        </div>
    </div>

    <!-- Página de información de contacto -->
    <div id="contactPage" class="container">
        <div class="contact-card">
            <div class="contact-header">
                <h2 id="contactTitle"></h2>
            </div>
            
            <div class="contact-info">
                <div class="contact-item" id="contactNameItem" style="display: none;">
                    <i class="fas fa-user"></i>
                    <div>
                        <strong>Nombre:</strong> <span id="contactName"></span>
                    </div>
                </div>
                
                <div class="contact-item" id="contactEmailItem" style="display: none;">
                    <i class="fas fa-envelope"></i>
                    <div>
                        <strong>Email:</strong> <span id="contactEmail"></span>
                    </div>
                </div>
                
                <div class="contact-item" id="contactPhoneItem" style="display: none;">
                    <i class="fas fa-phone"></i>
                    <div>
                        <strong>Teléfono:</strong> <span id="contactPhone"></span>
                    </div>
                </div>
            </div>
            
            <div class="contact-message" id="contactMessageSection" style="display: none;">
                <p id="contactPhrase1Section" style="display: none;"><strong>Español:</strong> <span id="contactPhrase1"></span></p>
                <p id="contactPhrase2Section" style="display: none;"><strong>English:</strong> <span id="contactPhrase2"></span></p>
            </div>
            
            <a href="#" class="back-button" onclick="showGenerator()">
                Usar el Generador
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script>
        let currentQRDataURL = null;
        let qrContent = null;
        let qrUrl = null;
        let contactData = {};

        // Manejar la visualización de páginas
        function showContactPage() {
            document.getElementById('generatorPage').style.display = 'none';
            document.getElementById('contactPage').style.display = 'block';
        }

        function showGenerator() {
            document.getElementById('contactPage').style.display = 'none';
            document.getElementById('generatorPage').style.display = 'block';
            window.location.hash = '';
        }

        // Función para obtener parámetros de la URL
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const pairs = queryString.split('&');
            
            for (let i = 0; i < pairs.length; i++) {
                const pair = pairs[i].split('=');
                const key = decodeURIComponent(pair[0]);
                const value = decodeURIComponent(pair[1] || '');
                params[key] = value;
            }
            
            return params;
        }

        // Comprobar si estamos en la página de contacto al cargar
        window.onload = function() {
            const params = getUrlParams();
            
            if (Object.keys(params).length > 0) {
                // Mostrar la página de contacto con los datos de la URL
                displayContactData(params);
                showContactPage();
            }
        };

        function openModal() {
            document.getElementById('dataModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('dataModal').style.display = 'none';
        }

        function openDeviceModal() {
            if (!currentQRDataURL) {
                alert('Primero genera un código QR');
                return;
            }
            document.getElementById('deviceModal').style.display = 'block';
        }

        function closeDeviceModal() {
            document.getElementById('deviceModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('dataModal');
            if (event.target === modal) {
                closeModal();
            }
            
            const deviceModal = document.getElementById('deviceModal');
            if (event.target === deviceModal) {
                closeDeviceModal();
            }
        }

        // Mostrar preview del logo
        document.getElementById('logo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = `<img src="${e.target.result}" class="logo-preview" alt="Preview del logo">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Convertir imagen a base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Crear contenido estructurado del QR
        function createQRContent(data) {
            let content = `=== ${data.title} ===\n\n`;
            
            if (data.fullName) {
                content += `Nombre: ${data.fullName}\n`;
            }
            
            if (data.phrase1) {
                content += `\nEspañol: ${data.phrase1}\n`;
            }
            
            if (data.phrase2) {
                content += `English: ${data.phrase2}\n`;
            }
        
            
            if (data.email || data.phone) {
                content += `\n--- Contacto ---\n`;
                if (data.email) content += `Email: ${data.email}\n`;
                if (data.phone) content += `Teléfono: ${data.phone}\n`;
            }
            
            return content;
        }

        // Función para superponer el logo en el QR
        function addLogoToQR(qrCanvas, logoBase64) {
            return new Promise((resolve) => {
                const ctx = qrCanvas.getContext('2d');
                const logoImg = new Image();
                
                logoImg.onload = function() {
                    const logoSize = Math.min(qrCanvas.width, qrCanvas.height) * 0.15;
                    const x = (qrCanvas.width - logoSize) / 2;
                    const y = (qrCanvas.height - logoSize) / 2;
                    
                    // Crear un fondo blanco para el logo
                    ctx.fillStyle = 'white';
                    ctx.fillRect(x - 5, y - 5, logoSize + 10, logoSize + 10);
                    
                    // Dibujar el logo
                    ctx.drawImage(logoImg, x, y, logoSize, logoSize);
                    resolve();
                };
                
                logoImg.src = logoBase64;
            });
        }

        // Codificar datos para URL
        function encodeData(data) {
            return Object.keys(data)
                .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(data[key])}`)
                .join('&');
        }

        async function generateQR() {
            const logoFile = document.getElementById('logo').files[0];
            const title = document.getElementById('title').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const phrase1 = document.getElementById('phrase1').value.trim();
            const phrase2 = document.getElementById('phrase2').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const qrSize = parseInt(document.getElementById('qrSize').value);

            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            closeModal();

            try {
                // Crear datos para el QR
                contactData = {
                    title,
                    fullName,
                    phrase1,
                    phrase2,
                    email,
                    phone,
                };

                // Crear contenido del QR
                qrContent = createQRContent(contactData);
                
                // Generar URL única para este QR con todos los datos
                qrUrl = `${window.location.origin}${window.location.pathname}?${encodeData(contactData)}`;
                
                // Generar QR usando qrcode.js
                const canvas = document.getElementById('qrCanvas');
                
                // Configurar opciones del QR
                const options = {
                    width: qrSize,
                    height: qrSize,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#ffffff'
                    },
                    errorCorrectionLevel: 'H'
                };

                // Generar QR con la URL
                await QRCode.toCanvas(canvas, qrUrl, options);

                // Agregar el logo al QR si existe
                if (logoFile) {
                    const logoBase64 = await fileToBase64(logoFile);
                    await addLogoToQR(canvas, logoBase64);
                }

                currentQRDataURL = canvas.toDataURL('image/png');
                displayResults();

            } catch (error) {
                console.error('Error:', error);
                alert('Error al generar el código QR: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayContactData(data) {
            // Mostrar título
            if (data.title) {
                document.getElementById('contactTitle').textContent = data.title;
            }
            
            // Mostrar nombre
            if (data.fullName) {
                document.getElementById('contactName').textContent = data.fullName;
                document.getElementById('contactNameItem').style.display = 'flex';
            }
            
            // Mostrar email
            if (data.email) {
                document.getElementById('contactEmail').textContent = data.email;
                document.getElementById('contactEmailItem').style.display = 'flex';
            }
            
            // Mostrar teléfono
            if (data.phone) {
                document.getElementById('contactPhone').textContent = data.phone;
                document.getElementById('contactPhoneItem').style.display = 'flex';
            }
            
            // Mostrar mensajes si existen
            let hasMessages = false;
            if (data.phrase1) {
                document.getElementById('contactPhrase1').textContent = data.phrase1;
                document.getElementById('contactPhrase1Section').style.display = 'block';
                hasMessages = true;
            }
            
            if (data.phrase2) {
                document.getElementById('contactPhrase2').textContent = data.phrase2;
                document.getElementById('contactPhrase2Section').style.display = 'block';
                hasMessages = true;
            }
            
            if (hasMessages) {
                document.getElementById('contactMessageSection').style.display = 'block';
            }
        }

        function displayResults() {
            // Mostrar contenido generado
            document.getElementById('generatedUrl').textContent = qrUrl;
            document.getElementById('urlInfo').style.display = 'block';
            
            // Mostrar preview del contenido
            document.getElementById('previewContent').textContent = qrContent;
            document.getElementById('previewSection').style.display = 'block';
            
            showResult();
        }

        function showResult() {
            document.getElementById('resultSection').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({
                    behavior: 'smooth'
                });
            }, 100);
        }

        function testQR() {
            if (qrUrl) {
                // Abrir la URL en una nueva pestaña para probar
                window.open(qrUrl, '_blank');
            } else {
                alert('Primero genera un código QR');
            }
        }

        function downloadQR() {
            if (currentQRDataURL) {
                try {
                    const link = document.createElement('a');
                    link.download = 'qr-personalizado.png';
                    link.href = currentQRDataURL;
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                } catch (error) {
                    console.error('Error al descargar:', error);
                    alert('Error al descargar el archivo');
                }
            } else {
                alert('Primero genera un código QR');
            }
        }

        function generateWallpaper(deviceType) {
            if (!currentQRDataURL) {
                alert('Primero genera un código QR');
                return;
            }

            // Definir dimensiones según el tipo de dispositivo
            let width, height;
            switch(deviceType) {
                case 'mobile':
                    width = 1440;
                    height = 1920;
                    break;
                case 'tablet':
                    width = 2880;
                    height = 1800;
                    break;
                case 'desktop':
                    width = 3840 ;
                    height = 2400;
                    break;
                default:
                    width = 1080;
                    height = 1920;
            }

            // Crear un canvas para el fondo de pantalla
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            // Rellenar con fondo negro
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, width, height);

            // Cargar la imagen del QR
            const qrImg = new Image();
            qrImg.onload = function() {
                // Calcular tamaño y posición del QR en el centro
                const qrSize = Math.min(width, height) * 0.6; // 60% del tamaño más pequeño
                const x = (width - qrSize) / 2;
                const y = (height - qrSize) *1.5;
                
                // Dibujar el QR
                ctx.drawImage(qrImg, x, y, qrSize, qrSize);
                
                // Descargar la imagen
                const link = document.createElement('a');
                link.download = `fondo-qr-${deviceType}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Cerrar el modal
                closeDeviceModal();
            };
            
            qrImg.src = currentQRDataURL;
        }
    </script>
</body>
</html>
